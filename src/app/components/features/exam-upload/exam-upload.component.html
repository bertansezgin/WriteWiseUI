<!-- Sınav Yükle -->
<div class="h-full max-h-full overflow-auto px-4 lg:px-6 pt-0 lg:pt-0 pb-4">
  <!-- Kapat Butonu -->
  <div class="flex justify-end mb-2">
    <button class="btn btn-ghost p-2" (click)="appState.collapseAll()" aria-label="Kapat">
      <span class="text-lg font-bold text-espresso">✕</span>
    </button>
  </div>

  <!-- Dosya Yükleme Alanı (Drag & Drop) -->
  <div
    class="border-2 border-dashed border-borderGray rounded-lg p-8 text-center transition-colors max-w-3xl mx-auto"
    [ngClass]="{ 'border-primary bg-primary/5': isDraggingOver, 'opacity-60 pointer-events-none': isUploading }"
    (drop)="onDrop($event)"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    aria-label="Sınav dosyası yükleme alanı"
    role="region"
  >
    <div class="text-sm text-espresso/70" *ngIf="!hasSelectedFile">Dosyanızı buraya bırakın veya</div>
    <div class="mt-3 flex flex-wrap items-center justify-center gap-3">
      <input type="file" accept=".pdf,.png,.jpg,.jpeg" class="hidden" id="exam-file-input" (change)="onFileInputChange($event)"/>
      <label for="exam-file-input" class="btn btn-secondary">Dosya Seç</label>
      <button class="btn bg-primary-pressed hover:bg-[#4b7454] text-white" (click)="onAnalysisStart()" [disabled]="!hasSelectedFile || isUploading">
        <span *ngIf="!isUploading">Analizi Başlat</span>
        <span *ngIf="isUploading">Yükleniyor…</span>
      </button>
      <button class="btn btn-ghost p-2" (click)="appState.collapseAll()" aria-label="İptal">
        <span class="text-lg font-bold text-espresso">✕</span>
      </button>
    </div>

    <!-- Seçilen dosya özeti -->
    <div class="mt-4 flex items-center justify-center gap-3" *ngIf="hasSelectedFile">
      <div class="text-sm text-espresso bg-slate-50 border border-borderGray rounded-md px-3 py-2">
        {{ selectedFile?.name }} · {{ selectedFile ? formatFileSize(selectedFile.size) : '' }}
      </div>
      <button class="btn btn-secondary btn-outline" (click)="clearSelectedFile()" [disabled]="isUploading">Temizle</button>
    </div>

    <!-- Yükleme/Analiz İlerleme Çubuğu -->
    <div class="mt-4 h-2 w-full bg-gray-100 rounded-full overflow-hidden" *ngIf="isUploading">
      <div class="h-full bg-primary transition-all" [style.width.%]="uploadProgress"></div>
    </div>

    <!-- Yardım Metni -->
    <div class="mt-3 text-xs text-espresso/60">
      PDF, PNG, JPG dosyaları desteklenir. Maksimum 25MB.
    </div>
  </div>

  <!-- LLM Değerlendirme Kuralları -->
  <div class="mt-3 max-w-3xl mx-auto">
    <label class="text-sm font-semibold text-black">LLM Değerlendirme Kuralları</label>
    <textarea
      rows="5"
      id="rules-textarea"
      class="mt-2 w-full rounded-md border border-borderGray px-3 py-2 text-sm"
      placeholder="Açık uçlu sorularda anahtar kavramlar geçerse kısmi puan ver.&#10;Doğru yöntem-yanlış sonuç için %50 puan uygula.&#10;Çoktan seçmelide net anahtar: yalnız doğru seçenek tam puan."
      [disabled]="isUploading"
    ></textarea>
  </div>

  <!-- Sınav Detayları -->
  <div class="mt-2 grid sm:grid-cols-2 lg:grid-cols-3 gap-3 max-w-3xl mx-auto">
    <!-- Ders -->
    <div>
      <label class="text-sm font-semibold text-black">Ders</label>
      <input
        id="subject-input"
        class="mt-1 w-full rounded-md border border-borderGray px-3 py-2 text-sm"
        placeholder="Ders adını giriniz"
        [disabled]="isUploading"
      />
    </div>

    <!-- Sınıflar -->
    <div>
      <label class="text-sm font-semibold text-black">Sınıf(lar)</label>
      <div class="mt-1 flex items-center gap-2">
        <input
          class="flex-1 rounded-md border border-borderGray px-3 py-2 text-sm uppercase tracking-wide"
          placeholder="Örn: 4A, 12B"
          [value]="classInput"
          (input)="onClassInputChange($event)"
          [disabled]="isUploading"
        />
        <button class="btn btn-secondary" (click)="addClass()" [disabled]="isUploading">Ekle</button>
      </div>
      <div class="text-xs text-red-600 mt-1" *ngIf="classError">{{ classError }}</div>
      <div class="mt-2 flex flex-wrap gap-2">
        <span class="chip" *ngFor="let c of classes">
          {{ c }}
          <button class="ml-1 text-espresso/70 hover:text-espresso" (click)="removeClass(c)" aria-label="Sınıfı kaldır">✕</button>
        </span>
      </div>
    </div>

    <!-- Tarih -->
    <div>
      <label class="text-sm font-semibold text-black">Tarih</label>
      <input
        [type]="dateInputType"
        id="date-input"
        class="mt-1 w-full rounded-md border border-borderGray px-3 py-2 text-sm bg-transparent placeholder:text-espresso/40"
        [disabled]="isUploading"
        placeholder="gg.aa.yyyy"
        (focus)="onDateFocus()"
        (blur)="onDateBlur($event)"
      />
    </div>
  </div>
</div>
