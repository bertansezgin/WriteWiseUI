<!-- Sınıfların Genel Durumu -->
<div class="h-full p-4 sm:p-6 overflow-hidden">
  <!-- Kapat Butonu -->
  <div class="flex justify-end mb-1">
    <button class="btn btn-ghost p-2" (click)="appState.collapseAll()" aria-label="Kapat">
      <span class="text-lg font-bold text-espresso">✕</span>
    </button>
  </div>
  
  <div class="hidden md:grid gap-3 lg:grid-cols-2 xl:grid-cols-3 h-full" style="grid-template-columns: 1fr 1.15fr 1.15fr;">
    <!-- Sol: Sınıf Listesi -->
    <section class="flexible-content overflow-hidden">
      <div class="flex items-center justify-between">
        <h4 class="text-base font-semibold text-espresso">Sınıflar</h4>
      </div>
      <div class="mt-2 max-h-[calc(100%-44px)] overflow-auto divide-y divide-borderGray/60 rounded-lg border border-borderGray">
        <button 
          *ngFor="let className of classSummaryService.classes(); index as i" 
          class="group w-full text-left h-14 px-3 relative" 
          [ngClass]="{'bg-infoSurface/30': classSummaryService.selectedClass()===className}" 
          (click)="classSummaryService.chooseClass(className)">
          <div class="flex items-center justify-between h-full">
            <div class="text-[17px] font-semibold text-espresso">{{ className }}</div>
            <div *ngIf="classSummaryService.selectedClass()===className" class="text-primary">✔</div>
          </div>
        </button>
      </div>
    </section>
    
    <!-- Orta: Ders Listesi -->
    <section class="flexible-content hidden lg:block" [class.animate-slide-in]="classSummaryService.selectedClass()">
      <div *ngIf="!classSummaryService.selectedClass()" class="h-full min-h-[280px] border-2 border-dashed border-borderGray rounded-lg grid place-items-center text-espresso/50">Seçim yapın</div>
      <div *ngIf="classSummaryService.selectedClass()">
        <div class="text-base font-semibold text-espresso">{{ classSummaryService.selectedClass() }}</div>
        <div class="mt-2 max-h-[48vh] overflow-auto divide-y divide-borderGray/60 rounded-lg border border-borderGray">
          <button 
            *ngFor="let subject of classSummaryService.subjects()" 
            class="w-full text-left h-12 px-3 relative hover:bg-primary/10" 
            (click)="classSummaryService.chooseSubject(subject)" 
            [ngClass]="{'bg-infoSurface/30': classSummaryService.selectedSubject()===subject}">
            <div class="flex items-center justify-between h-full">
              <div class="text-[15px] font-semibold text-espresso">{{ subject }}</div>
              <div *ngIf="classSummaryService.selectedSubject()===subject" class="text-primary">✔</div>
            </div>
          </button>
        </div>
      </div>
    </section>
    
    <!-- Sağ: İstatistikler -->
    <section class="flexible-content hidden xl:block" [class.animate-slide-in]="classSummaryService.selectedSubject()">
      <div *ngIf="!classSummaryService.selectedSubject()" class="h-full min-h-[280px] border-2 border-dashed border-borderGray rounded-lg grid place-items-center text-espresso/50">Seçim yapın</div>
      <div *ngIf="classSummaryService.selectedSubject()" class="space-y-2">
        <div class="text-base font-semibold text-espresso">{{ classSummaryService.selectedClass() }} · {{ classSummaryService.selectedSubject() }}</div>
        
        <!-- Sınıf İstatistikleri -->
        <div class="card p-3" *ngIf="classSummaryService.classStats()">
          <div class="grid sm:grid-cols-2 gap-4 items-center">
            <div>
              <div class="text-xs text-espresso/60 mb-1">Sınıf Ortalaması</div>
              <div class="text-4xl font-semibold text-espresso">{{ classSummaryService.classStats()?.avg }} / 100</div>
              <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                <div class="h-full bg-primary" [style.width.%]="classSummaryService.classStats()?.avg || 0"></div>
              </div>
            </div>
            <div>
              <div class="text-xs text-espresso/60 mb-1">Kopya İhtimali</div>
              <div class="text-2xl font-semibold text-espresso">%{{ classSummaryService.classStats()?.copyProb }}</div>
              <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                <div class="h-full rounded-full" 
                     [ngStyle]="{ 
                       width: ((classSummaryService.classStats()?.copyProb || 0) + '%'), 
                       background: (classSummaryService.classStats()?.copyProb||0) < 15 ? '#22c55e' : 
                                  (classSummaryService.classStats()?.copyProb||0) < 40 ? '#eab308' : '#ef4444' 
                     }"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Puan Aralığı Grafiği -->
        <div class="card p-3" *ngIf="classSummaryService.classStats()">
          <div class="text-sm font-medium text-espresso mb-2">Sınav Puan Aralığı</div>
          <div class="flex items-center gap-6">
            <svg width="120" height="120" viewBox="0 0 36 36" class="-rotate-90">
              <circle cx="18" cy="18" r="15.5" stroke="#e5e7eb" stroke-width="6" fill="none" stroke-dasharray="100 100"/>
              <ng-container *ngFor="let seg of classSummaryService.rangesChartSegments()">
                <circle cx="18" cy="18" r="15.5" 
                        [attr.stroke]="seg.color" 
                        stroke-width="6" 
                        fill="none" 
                        [attr.stroke-dasharray]="seg.length + ' 100'" 
                        [attr.stroke-dashoffset]="-seg.offset"></circle>
              </ng-container>
            </svg>
            <div class="text-sm space-y-1">
              <div *ngFor="let seg of classSummaryService.rangesChartSegments()" class="flex items-center gap-2">
                <span class="inline-block w-3 h-3 rounded" [style.background]="seg.color"></span>
                <span>{{ seg.label }} — {{ seg.count }} kişi</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Export Butonları -->
        <div class="flex gap-2">
          <button class="btn btn-secondary">PDF</button>
          <button class="btn btn-secondary">CSV</button>
        </div>
      </div>
    </section>

    <!-- lg: Analysis below -->
    <section class="lg:col-span-2 xl:hidden" [class.hidden]="!classSummaryService.selectedSubject()">
      <div *ngIf="classSummaryService.selectedSubject()" class="animate-slide-in space-y-2">
        <div class="text-base font-semibold text-espresso">{{ classSummaryService.selectedClass() }} · {{ classSummaryService.selectedSubject() }}</div>
        
        <!-- Tekrarlanan İstatistik Kartları lg layout için -->
        <div class="card p-3" *ngIf="classSummaryService.classStats()">
          <div class="grid sm:grid-cols-2 gap-4 items-center">
            <div>
              <div class="text-xs text-espresso/60 mb-1">Sınıf Ortalaması</div>
              <div class="text-4xl font-semibold text-espresso">{{ classSummaryService.classStats()?.avg }} / 100</div>
              <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                <div class="h-full bg-primary" [style.width.%]="classSummaryService.classStats()?.avg || 0"></div>
              </div>
            </div>
            <div>
              <div class="text-xs text-espresso/60 mb-1">Kopya İhtimali</div>
              <div class="text-2xl font-semibold text-espresso">%{{ classSummaryService.classStats()?.copyProb }}</div>
              <div class="mt-2 h-3 w-full bg-borderGray/50 rounded-full overflow-hidden">
                <div class="h-full rounded-full" 
                     [ngStyle]="{ 
                       width: ((classSummaryService.classStats()?.copyProb || 0) + '%'), 
                       background: (classSummaryService.classStats()?.copyProb||0) < 15 ? '#22c55e' : 
                                  (classSummaryService.classStats()?.copyProb||0) < 40 ? '#eab308' : '#ef4444' 
                     }"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="card p-3" *ngIf="classSummaryService.classStats()">
          <div class="text-sm font-medium text-espresso mb-2">Sınav Puan Aralığı</div>
          <div class="flex items-center gap-6">
            <svg width="120" height="120" viewBox="0 0 36 36" class="-rotate-90">
              <circle cx="18" cy="18" r="15.5" stroke="#e5e7eb" stroke-width="6" fill="none" stroke-dasharray="100 100"/>
              <ng-container *ngFor="let seg of classSummaryService.rangesChartSegments()">
                <circle cx="18" cy="18" r="15.5" 
                        [attr.stroke]="seg.color" 
                        stroke-width="6" 
                        fill="none" 
                        [attr.stroke-dasharray]="seg.length + ' 100'" 
                        [attr.stroke-dashoffset]="-seg.offset"></circle>
              </ng-container>
            </svg>
            <div class="text-sm space-y-1">
              <div *ngFor="let seg of classSummaryService.rangesChartSegments()" class="flex items-center gap-2">
                <span class="inline-block w-3 h-3 rounded" [style.background]="seg.color"></span>
                <span>{{ seg.label }} — {{ seg.count }} kişi</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
