<!-- Yüklediğim Sınavlar -->
<div class="h-full px-2 sm:px-3 pt-0 pb-2 overflow-hidden">
  <!-- Kapat Butonu -->
  <div class="flex justify-end -mb-1 mt-1">
    <button class="btn btn-ghost px-1 py-0" (click)="appState.collapseAll()" aria-label="Kapat">
      <span class="text-base font-bold text-espresso">✕</span>
    </button>
  </div>
  
  <!-- Üst Kısım: Liste + Özet -->
  <div class="hidden md:grid gap-4 h-[40vh] grid-cols-[1.5fr_1fr]">
    <!-- Sınav Listesi -->
    <section class="flex flex-col h-full overflow-hidden">
      <div class="mb-2 text-center">
        <h4 class="text-base font-semibold text-espresso">Yüklenen Sınavlar Listesi</h4>
      </div>
      <div class="flex-1 border border-borderGray rounded-lg overflow-hidden">
        <div class="bg-slate-50 border-b border-borderGray text-espresso/70 sticky top-0 z-10">
          <div class="grid grid-cols-5 text-left p-3 font-semibold text-base">
            <div>Ders</div>
            <div>Sınıf</div>
            <div>Tarih</div>
            <div>Öğrenci</div>
            <div>Durum</div>
          </div>
        </div>
        <div class="flex-1 overflow-auto">
          <div 
            *ngFor="let exam of uploadedExamService.uploadedExams()" 
            (click)="uploadedExamService.selectUploadedExam(exam)" 
            class="grid grid-cols-5 border-b border-borderGray/60 hover:bg-primary/10 cursor-pointer p-3" 
            [ngClass]="{'bg-infoSurface/30': uploadedExamService.selectedUpload()?.id===exam.id}">
            <div class="font-semibold">{{ exam.subject }}</div>
            <div>{{ exam.clazz }}</div>
            <div>{{ exam.date }}</div>
            <div>{{ exam.students }}</div>
            <div><span class="chip">{{ exam.status }}</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Detay Paneli -->
    <section class="flex flex-col h-full">
      <div class="mb-2">
        <h4 class="text-base font-semibold text-espresso invisible">Placeholder</h4>
      </div>
      
      <!-- Seçilmiş Sınav Detayı -->
      <div class="card p-3 h-full flex flex-col" *ngIf="uploadedExamService.selectedUpload(); else noSelection">
        <!-- Başlık + Sorular Butonu -->
        <div class="flex items-center justify-between mb-3">
          <div class="text-base font-semibold text-espresso">
            {{ uploadedExamService.selectedUpload()?.subject + ' · ' + uploadedExamService.selectedUpload()?.clazz }}
          </div>
          <button class="btn btn-secondary" (click)="uploadedExamService.openUploadSection('sorular')">Sorular</button>
        </div>
        
        <!-- Özet Bilgileri -->
        <div class="text-sm font-medium mb-2">Sınav Özeti</div>
        <div class="grid grid-cols-2 gap-2 flex-1">
          <div class="bg-slate-50 p-2 rounded-lg">
            <div class="text-sm font-semibold text-espresso">Sınıf Not Ortalaması</div>
            <div class="text-mono text-xl">78</div>
          </div>
          <div class="bg-slate-50 p-2 rounded-lg">
            <div class="text-sm font-semibold text-espresso">En Yüksek Not</div>
            <div class="text-mono text-lg">94</div>
          </div>
          <div class="bg-slate-50 p-2 rounded-lg">
            <div class="text-sm font-semibold text-espresso">En Düşük Not</div>
            <div class="text-mono text-lg">52</div>
          </div>
          <div class="bg-slate-50 p-2 rounded-lg">
            <div class="text-sm font-semibold text-espresso">Soru Sayısı</div>
            <div class="text-mono text-lg">12</div>
          </div>
        </div>
      </div>
      
      <!-- Seçim Yapılmadığında -->
      <ng-template #noSelection>
        <div class="card p-3 h-full grid place-items-center">
          <div class="text-center">
            <div class="text-base font-semibold text-espresso mb-1">Seçim yapın</div>
            <div class="text-xs text-espresso/70">Listeden bir sınav seçin.</div>
          </div>
        </div>
      </ng-template>
    </section>
  </div>

  <!-- Alt Kısım: Sorular Paneli -->
  <div class="hidden md:block mt-4" *ngIf="uploadedExamService.selectedUpload() && uploadedExamService.uploadTab()==='sorular'">
    <div class="card h-[42vh] flex flex-col animate-slide-in">
      <!-- Başlık (Sabit) -->
      <div class="text-base font-semibold text-espresso p-4 pb-2 border-b border-borderGray">
        {{ uploadedExamService.selectedUpload()?.date }} {{ uploadedExamService.selectedUpload()?.subject }} Sınavı
      </div>
      
      <!-- İçerik (Scroll) -->
      <div class="flex-1 overflow-auto p-4">
        <div *ngIf="uploadedExamService.currentQuestion() as q; else noQuestion">
          <!-- Soru Başlığı -->
          <div class="text-lg font-semibold text-espresso mb-4">
            {{ (uploadedExamService.currentQuestionIdx()+1) }}. Soru: {{ q.text }}
          </div>
          
          <!-- Ana İçerik Grid -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
            <!-- Sol: Grup Cevapları -->
            <div class="lg:col-span-2">
              <h4 class="text-sm font-semibold text-espresso mb-2">Öğrenci Cevapları</h4>
              <div class="space-y-2">
                <div *ngFor="let group of q.groups; index as gi" class="bg-slate-50 p-3 rounded-lg">
                  <div class="text-sm font-medium text-espresso mb-1">Grup {{ gi+1 }} — {{ group.count }} kişi</div>
                  <ul class="list-disc pl-4 text-sm text-espresso/80">
                    <li *ngFor="let answer of group.answers">{{ answer }}</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <!-- Sağ: Puanlama -->
            <div class="space-y-3">
              <!-- LLM Puanı -->
              <div class="bg-blue-50 p-3 rounded-lg">
                <div class="text-sm font-semibold text-blue-800">LLM Puanı</div>
                <div class="text-xl font-bold text-blue-900">{{ q.llmScore }} / {{ q.maxScore }}</div>
                <div class="text-xs text-blue-700 mt-1">{{ q.rationale }}</div>
              </div>
              
              <!-- Öğretmen Puanı -->
              <div class="bg-green-50 p-3 rounded-lg">
                <div class="text-sm font-semibold text-green-800 mb-2">Öğretmen Puanı</div>
                <div class="flex items-center gap-2 mb-2">
                  <button class="btn btn-secondary text-xs px-2 py-1" (click)="uploadedExamService.adjustTeacherScore(-1)">-1</button>
                  <input 
                    type="number" 
                    class="w-16 rounded-md border border-borderGray px-2 py-1 text-sm text-center" 
                    [value]="q.teacherScore" 
                    (input)="uploadedExamService.setTeacherScore(+$any($event.target).value)"/>
                  <button class="btn btn-secondary text-xs px-2 py-1" (click)="uploadedExamService.adjustTeacherScore(1)">+1</button>
                </div>
                <div class="text-xs text-green-700">Maksimum: {{ q.maxScore }}</div>
              </div>
            </div>
          </div>
        </div>
        <ng-template #noQuestion>
          <div class="text-sm text-espresso/70">Soru bulunamadı.</div>
        </ng-template>
      </div>
      
      <!-- Navigasyon (Sabit Alt) -->
      <div class="flex items-center justify-between p-3 pt-2 border-t border-borderGray bg-gray-50">
        <button class="btn btn-primary px-3 py-2" (click)="uploadedExamService.prevQuestion()">← Önceki</button>
        <div class="text-sm font-semibold text-espresso">
          Soru {{ uploadedExamService.currentQuestionIdx()+1 }} / {{ uploadedExamService.currentQuestions().length }}
        </div>
        <button class="btn btn-primary px-3 py-2" (click)="uploadedExamService.nextQuestion()">Sonraki →</button>
      </div>
    </div>
  </div>
</div>
